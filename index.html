<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Boating Conditions</title>

<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: Arial, Helvetica, sans-serif;
  }

  .card {
    border: 1px solid #333;
    border-radius: 18px;
    padding: 24px 28px;
    background: rgba(255,255,255,0.06);
    max-width: 580px;
    margin: 0 auto;
    text-align: center;
  }

  h2 {
    margin: 0 0 14px;
    font-size: 34px;
  }

  .section {
    margin-top: 20px;
  }

  .label {
    font-size: 18px;
    opacity: 0.8;
  }

  .time {
    font-size: 36px;
    font-weight: bold;
    margin: 6px 0;
  }

  .detail {
    font-size: 18px;
    opacity: 0.85;
  }

  .good { color: #8fff9a; }
  .bad  { color: #ff9a9a; }
  .neutral { color: #ffd27d; }
</style>
</head>

<body>

<div class="card">
  <h2>üö§ Boating Conditions</h2>

  <div class="section">
    <div class="label">Best time today (3h)</div>
    <div id="bestToday" class="time good">‚Äì</div>
    <div id="bestTodayDetail" class="detail"></div>
  </div>

  <div class="section">
    <div class="label">Worst time today (3h)</div>
    <div id="worstToday" class="time bad">‚Äì</div>
    <div id="worstTodayDetail" class="detail"></div>
  </div>

  <div class="section">
    <div class="label">Best time tomorrow (3h)</div>
    <div id="bestTomorrow" class="time neutral">‚Äì</div>
    <div id="bestTomorrowDetail" class="detail"></div>
  </div>
</div>

<script>
const LAT = -27.1153;
const LON = 152.5565;
const TZ = "Australia/Brisbane";

const WINDOW = 3; // ‚è± 3-hour window

// Simple inland wave proxy (cm) based on wind
function waveProxy(windKmh) {
  if (windKmh < 5) return 0;
  if (windKmh < 10) return 10;
  if (windKmh < 15) return 20;
  if (windKmh < 20) return 35;
  if (windKmh < 25) return 50;
  return 70;
}

function fmt(t) {
  return new Date(t).toLocaleTimeString("en-AU", {
    timeZone: TZ,
    hour: "2-digit",
    minute: "2-digit"
  });
}

function windArrow(deg) {
  const arrows = ["‚¨ÜÔ∏è","‚ÜóÔ∏è","‚û°Ô∏è","‚ÜòÔ∏è","‚¨áÔ∏è","‚ÜôÔ∏è","‚¨ÖÔ∏è","‚ÜñÔ∏è"];
  return arrows[Math.round(deg / 45) % 8];
}

function score(w, p, r) {
  return w * 2 + p + r * 50;
}

async function load() {
  const r = await fetch(
    `https://api.open-meteo.com/v1/forecast` +
    `?latitude=${LAT}&longitude=${LON}` +
    `&hourly=wind_speed_10m,wind_direction_10m,precipitation_probability,precipitation` +
    `&timezone=${encodeURIComponent(TZ)}`,
    { cache: "no-store" }
  );

  const j = await r.json();
  const t = j.hourly.time;
  const w = j.hourly.wind_speed_10m;
  const wd = j.hourly.wind_direction_10m;
  const p = j.hourly.precipitation_probability;
  const rmm = j.hourly.precipitation;

  const today = new Date().toLocaleDateString("en-CA", { timeZone: TZ });
  const tomorrow = new Date(Date.now()+86400000)
    .toLocaleDateString("en-CA", { timeZone: TZ });

  function bestWorst(dateStr) {
    let best=null, worst=null;

    for(let i=0;i<t.length-WINDOW;i++){
      if(!t[i].startsWith(dateStr)) continue;
      const hour = new Date(t[i]).getHours();
      if(hour < 6 || hour > 15) continue;

      let mw=0, mp=0, mr=0, sc=0, dir=wd[i];
      for(let k=0;k<WINDOW;k++){
        mw = Math.max(mw, w[i+k]);
        mp = Math.max(mp, p[i+k]);
        mr += rmm[i+k];
        sc += score(w[i+k], p[i+k], rmm[i+k]);
      }

      const entry = {i, sc, mw, mp, mr, dir};
      if(!best || sc < best.sc) best = entry;
      if(!worst || sc > worst.sc) worst = entry;
    }
    return {best, worst};
  }

  const tBW = bestWorst(today);
  const tmBW = bestWorst(tomorrow);

  function fill(idT, idD, e){
    if(!e) return;
    document.getElementById(idT).textContent =
      `${fmt(t[e.i])} ‚Äì ${fmt(t[e.i+WINDOW-1])}`;

    document.getElementById(idD).textContent =
      `${windArrow(e.dir)} ${e.mw.toFixed(0)} km/h ¬∑ üåä ~${waveProxy(e.mw)} cm ¬∑ üåß ‚â§ ${e.mp}%`;
  }

  fill("bestToday", "bestTodayDetail", tBW.best);
  fill("worstToday", "worstTodayDetail", tBW.worst);
  fill("bestTomorrow", "bestTomorrowDetail", tmBW.best);
}

load();
setInterval(load, 30 * 60 * 1000);
</script>

</body>
</html>
